the code is modified from https://github.com/banctilrobitaille/torch-vectorized